<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - make.tiebreaker</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - utility.function -
Positioning Method - make.tiebreaker</h1>

<p>Make a tiebreaker function that can be used with code{link{qp.labels}}.</p>

<pre>
make.tiebreaker &lt;- function(x.var,tiebreak.var){
  force(x.var)
  force(tiebreak.var)
  function(d,...){
    orig &lt;- attr(d,"orig.data")
    xvals &lt;- unique(orig[,x.var])
    x &lt;- unique(d[,x.var])
    if(length(x)&gt;1){
      stop("labels are not aligned")
    }
    xvals &lt;- xvals[order(abs(xvals-x))]
    group.dfs &lt;- split(orig,orig$groups)
    m &lt;- do.call(cbind,lapply(d$groups,function(g){
      df &lt;- group.dfs[[as.character(g)]]
      group.x &lt;- df[,x.var]
      group.y &lt;- df[,tiebreak.var]
      all.unique &lt;- length(unique(group.x)) == length(group.x)
      ## approx gives the following error if we only have one point:
      ## need at least two non-NA values to interpolate
      x.not.missing &lt;- !is.na(group.x)
      y.not.missing &lt;- !is.na(group.y)
      not.missing &lt;- sum(x.not.missing &amp; y.not.missing)
      if(all.unique &amp;&amp; 1 &lt; not.missing){
        ## rule=2 means to use the most extreme value instead of the
        ## default NA, for any points that are outside the range -
        ## this is required to get a good ordering in some cases.
        approx(group.x, group.y, xvals, rule=2)$y
      }else{
        group.y
      }
    }))
    ## useful for debugging:
    ##print(m)
    L &lt;- lapply(1:nrow(m),function(i)m[i,])
    do.call(order,L)
  }
}
</pre>



<center>
<table>
<tr><td>Please
contact <a href="http://sugiyama-www.cs.titech.ac.jp/~toby/">Toby
Dylan Hocking</a> if you are
using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a>
or have ideas to contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from source
code version 2020.6.17
(svn revision )
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>

<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - qp.labels</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - utility.function -
Positioning Method - qp.labels</h1>

<p>Use a QP solver to find the best places to put the points on a
line, subject to the constraint that they should not
overlap.</p>

<pre>
qp.labels &lt;- function(var,spacer)function(d,...){
  if(!spacer%in%names(d))stop("need to have calculated ",spacer)
  require(quadprog)
  ## calculate a tiebreaker for the ordering. If we are doing a
  ## standard lineplot, then we can calculate where the line is going
  ## by looking at the nearest point. TODO: how to tiebreak in other
  ## situations, like <a href="../../lineplot/posfuns/lasso.labels.html">lasso.labels</a>?
  d$tiebreaker &lt;- if(var=="y"){
    sapply(seq_along(d$groups),function(i){
      others &lt;- subset(attr(d,"orig.data"),groups==d$groups[i] &amp; x!=d$x[i])
      others[which.min(abs(others$x-d$x[i])),"y"]
    })
  }else{
    1
  }
  ## sorts data so that target_1 &lt;= target_2 &lt;= ... &lt;= target_n
  d &lt;- d[order(d[,var],d$tiebreaker),]
  target &lt;- d[,var]
  k &lt;- nrow(d)
  D &lt;- diag(rep(1,k))
  ## These are the standard form matrices described in the
  ## directlabels poster
  Ik &lt;- diag(rep(1,k-1))
  A &lt;- rbind(0,Ik)-rbind(Ik,0)
  h &lt;- d[,spacer]
  b0 &lt;- (h[-k]+h[-1])/2
  sol &lt;- solve.QP(D,target,A,b0)
  d[,var] &lt;- sol$solution
  d
}
</pre>



<center>
<table>
<tr><td>Please contact <a href="http://cbio.ensmp.fr/~thocking/">Toby
Dylan Hocking</a> if you are using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a> or have ideas to
contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from comments
in R source code
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>

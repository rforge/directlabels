<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - lines2</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - lineplot -
Positioning Function - lines2</h1>

<p>Positioning Function for 2 groups of longitudinal data. One curve
is on top of the other one (on average), so we label the top one
at its maximal point, and the bottom one at its minimal
point. Vertical justification is chosen to minimize collisions
with the other line. This may not work so well for data with high
variability, but then again lineplots may not be the best for
these data either.</p>

<pre>
lines2 <- function
### Positioning Function for 2 groups of longitudinal data. One curve
### is on top of the other one (on average), so we label the top one
### at its maximal point, and the bottom one at its minimal
### point. Vertical justification is chosen to minimize collisions
### with the other line. This may not work so well for data with high
### variability, but then again lineplots may not be the best for
### these data either.
(d,
### The data.
 offset=0.3,
### Offset from 0 or 1 for the vjust values.
 ...
### ignored.
 ){
  top <- 0-offset
  bottom <- 1+offset
  y <- ddply(d,.(groups),function(d)mean(d$y))
  ddply(y,.(groups),function(D){
    biggest.on.average <- D$V==max(y$V)
    f <- if(biggest.on.average)max else min
    ld <- subset(d,groups==D$groups)
    pos <- ddply(subset(ld,y==f(ld$y)),.(groups),function(x)
          data.frame(x=max(x$x)-diff(range(x$x))/2,y=x$y[1]))
    other <- subset(d,groups!=D$groups)
    other.y <- other[which.min(abs(other$x-pos$x)),"y"]
    smaller.here <- pos$y<other.y
    data.frame(pos,vjust=if(biggest.on.average)
               if(smaller.here)bottom else top#bigger mean
               else if(smaller.here)bottom else top)#smaller mean
  })
}
</pre>

<table>
<tr>
  <td><img alt="bodyweight" src="../../lineplot/bodyweight.lines2.png" /></td>
  <td><p><a href="../plots/bodyweight.html">bodyweight</a></p><pre>
data(BodyWeight,package="nlme")
p &lt;- xyplot(weight~Time|Diet,BodyWeight,groups=Rat,type='l',
       layout=c(3,1),xlim=c(-10,75))
direct.label(p,"lines2")
  </pre></td>
</tr>
<tr>
  <td><img alt="chemqqmathscore" src="../../lineplot/chemqqmathscore.lines2.png" /></td>
  <td><p><a href="../plots/chemqqmathscore.html">chemqqmathscore</a></p><pre>
data(Chem97,package="mlmRev")
p &lt;- qqmath(~gcsescore|gender,Chem97,groups=factor(score),
       type=c('l','g'),f.value=ppoints(100))
direct.label(p,"lines2")
  </pre></td>
</tr>
<tr>
  <td><img alt="chemqqmathsex" src="../../lineplot/chemqqmathsex.lines2.png" /></td>
  <td><p><a href="../plots/chemqqmathsex.html">chemqqmathsex</a></p><pre>
data(Chem97,package="mlmRev")
p &lt;- qqmath(~gcsescore,Chem97,groups=gender,
       type=c("l","g"),f.value=ppoints(100))
direct.label(p,"lines2")
  </pre></td>
</tr>
<tr>
  <td><img alt="ridge" src="../../lineplot/ridge.lines2.png" /></td>
  <td><p><a href="../plots/ridge.html">ridge</a></p><pre>
## complicated ridge regression lineplot ex. fig 3.8 from Elements of
## Statistical Learning, Hastie et al.
myridge &lt;- function(f,data,lambda=c(exp(-seq(-15,15,l=200)),0)){
  require(MASS)
  fit &lt;- lm.ridge(f,data,lambda=lambda)
  X &lt;- data[-which(names(data)==as.character(f[[2]]))]
  Xs &lt;- svd(scale(X)) ## my d's should come from the scaled matrix
  dsq &lt;- Xs$d^2
  ## make the x axis degrees of freedom
  df &lt;- sapply(lambda,function(l)sum(dsq/(dsq+l)))
  D &lt;- data.frame(t(fit$coef),lambda,df) # scaled coefs
  molt &lt;- melt(D,id=c("lambda","df"))
  ## add in the points for df=0
  limpts &lt;- transform(subset(molt,lambda==0),lambda=Inf,df=0,value=0)
  rbind(limpts,molt)
}
data(prostate,package="ElemStatLearn")
pros &lt;- subset(prostate,train==TRUE,select=-train)
m &lt;- myridge(lpsa~.,pros)
p &lt;- xyplot(value~df,m,groups=variable,type="o",pch="+",
       panel=function(...){
         panel.xyplot(...)
         panel.abline(h=0)
         panel.abline(v=5,col="grey")
       },
       xlim=c(-1,9),
       main="Ridge regression shrinks least squares coefficients",
       ylab="scaled coefficients",
       sub="grey line shows coefficients chosen by cross-validation",
       xlab=expression(df(lambda)))
direct.label(p,"lines2")
  </pre></td>
</tr>
<tr>
  <td><img alt="sexdeaths" src="../../lineplot/sexdeaths.lines2.png" /></td>
  <td><p><a href="../plots/sexdeaths.html">sexdeaths</a></p><pre>
dts &lt;- cbind(male=mdeaths,female=fdeaths,time=1:length(mdeaths))
ddf &lt;- melt(as.data.frame(dts),id="time")
names(ddf) &lt;- c("time","sex","deaths")
p &lt;- qplot(time,deaths,data=ddf,colour=sex,geom="line")+xlim(-5,77)
direct.label(p,"lines2")
  </pre></td>
</tr>
</table>

<center>
<table>
<tr><td>Please send email
to <a href="http://r-forge.r-project.org/sendmessage.php?touser=1571">Toby
Dylan Hocking</a> if you are using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a> or have ideas to
contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from comments
in R source code
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>

<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - follow.points</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - scatterplot -
Positioning Method - follow.points</h1>

<p>Draws a line between each center and every point, then follows the
line out far enough to give a box outside the cloud. Out of all
the boxes constructed in this way that do not contain any points,
take the one which has the smallest distance to the center. FIXME:
does not work with ggplot2 since the ggplot2 backend doesn't yet
have support of actually knowing how big the text bounding box is.</p>

<pre>
follow.points &lt;- function
### Draws a line between each center and every point, then follows the
### line out far enough to give a box outside the cloud. Out of all
### the boxes constructed in this way that do not contain any points,
### take the one which has the smallest distance to the center. FIXME:
### does not work with ggplot2 since the ggplot2 backend doesn't yet
### have support of actually knowing how big the text bounding box is.
(d,debug=FALSE,...){
  allm &lt;- apply.method(list("<a href="../../utility.function/posfuns/dl.jitter.html">dl.jitter</a>","<a href="../../utility.function/posfuns/big.boxes.html">big.boxes</a>"),d)
  if(debug)<a href="../../utility.function/posfuns/draw.rects.html">draw.rects</a>(allm)
  labtab &lt;- data.frame()
  for(g in levels(d$groups)){
    x &lt;- d
    m &lt;- subset(allm,groups==g)
    x$a &lt;- x$y - m$y
    x$b &lt;- x$x - m$x
    x$h &lt;- sqrt(x$a^2+x$b^2) ## hypotenuse of triangle, not box height!
    x$x &lt;- x$x + m$w/2 * x$b/x$h *1.01 ## b/h = cos(theta)
    x$y &lt;- x$y + m$h/2 * x$a/x$h *1.01 ## a/h = sin(theta)
    x$dist &lt;- (x$x-m$x)^2+(x$y-m$y)^2
    x &lt;- transform(x,
                   left=x-m$w/2,right=x+m$w/2,
                   top=y+m$h/2,bottom=y-m$h/2)
    x$points &lt;- <a href="../../utility.function/posfuns/inside.html">inside</a>(x,d)
    ## consider only subset of boxes that contain no points
    x &lt;- subset(x,points==0)
    ## take the box with the minimal distance
    x &lt;- subset(x,dist==min(dist))[1,]
    labtab &lt;- rbind(labtab,transform(x,x=x,y=y,groups=g))
    ## add the box's 4 points to the list of points
    newpoints &lt;- d[1:4,]
    newpoints$x &lt;- c(x$left,x$right,x$right,x$left)
    newpoints$groups &lt;- g
    newpoints$y &lt;- c(x$top,x$top,x$bottom,x$bottom)
    d &lt;- rbind(d,newpoints)
  }
  labtab
}
</pre>

<table>
<tr>
  <td><img alt="class-manufacturer" src="../../scatterplot/class-manufacturer.follow.points.png" /></td>
  <td><p><a href="../plots/class-manufacturer.html">class-manufacturer</a></p><pre>
data(mpg,package="ggplot2")
m &lt;- lm(cty~displ,data=mpg)
mpgf &lt;- fortify(m,mpg)
library(lattice)
p &lt;- xyplot(jitter(.resid)~jitter(.fitted)|manufacturer,mpgf,groups=class)
direct.label(p,"follow.points")
  </pre></td>
</tr>
<tr>
  <td><img alt="cylinders" src="../../scatterplot/cylinders.follow.points.png" /></td>
  <td><p><a href="../plots/cylinders.html">cylinders</a></p><pre>
data(mpg,package="ggplot2")
m &lt;- lm(cty~displ,data=mpg)
mpgf &lt;- fortify(m,mpg)
library(lattice)
p &lt;- xyplot(jitter(.resid)~jitter(.fitted),mpgf,groups=factor(cyl))
direct.label(p,"follow.points")
  </pre></td>
</tr>
<tr>
  <td><img alt="iris" src="../../scatterplot/iris.follow.points.png" /></td>
  <td><p><a href="../plots/iris.html">iris</a></p><pre>
library(lattice)
p &lt;- xyplot(jitter(Sepal.Length)~jitter(Petal.Length),iris,groups=Species)
direct.label(p,"follow.points")
  </pre></td>
</tr>
<tr>
  <td><img alt="mpglattice" src="../../scatterplot/mpglattice.follow.points.png" /></td>
  <td><p><a href="../plots/mpglattice.html">mpglattice</a></p><pre>
data(mpg,package="ggplot2")
library(lattice)
p &lt;- xyplot(jitter(cty)~jitter(hwy),mpg,groups=class,
       main="Fuel efficiency depends on car size")
direct.label(p,"follow.points")
  </pre></td>
</tr>
<tr>
  <td><img alt="mpg" src="../../scatterplot/mpg.follow.points.png" /></td>
  <td><p><a href="../plots/mpg.html">mpg</a></p><pre>
library(ggplot2)
data(mpg,package="ggplot2")
p &lt;- qplot(jitter(hwy),jitter(cty),data=mpg,colour=class,
      main="Fuel efficiency depends on car size")
direct.label(p,"follow.points")
  </pre></td>
</tr>
<tr>
  <td><img alt="path" src="../../scatterplot/path.follow.points.png" /></td>
  <td><p><a href="../plots/path.html">path</a></p><pre>
data(normal.l2.cluster,package="directlabels")
library(ggplot2)
p &lt;- ggplot(normal.l2.cluster$path,aes(x,y))+
  geom_path(aes(group=row),colour="grey")+
  geom_point(aes(size=lambda),colour="grey")+
  geom_point(aes(colour=class),data=normal.l2.cluster$pts,pch=21,fill="white")+
  coord_equal()
direct.label(p,"follow.points")
  </pre></td>
</tr>
</table>

<center>
<table>
<tr><td>Please contact <a href="http://cbio.ensmp.fr/~thocking/">Toby
Dylan Hocking</a> if you are using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a> or have ideas to
contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from comments
in R source code
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>

<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - empty.grid</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - scatterplot -
Positioning Function - empty.grid</h1>

<p>Label placement method for scatterplots that ensures labels are
placed in different places. A grid is drawn over the whole
plot. Each cluster is considered in sequence and assigned to the
point on this grid which is closest to the point given by
loc.fun().</p>

<pre>
empty.grid &lt;- function
### Label placement method for scatterplots that ensures labels are
### placed in different places. A grid is drawn over the whole
### plot. Each cluster is considered in sequence and assigned to the
### point on this grid which is closest to the point given by
### loc.fun().
(d,
### Data frame of points on the scatterplot with columns groups x y.
 debug=FALSE,
### Show debugging info on the plot? This is passed to loc.fun.
 loc.fun=<a href="../../scatterplot/posfuns/get.means.html">get.means</a>,
### Function that takes d and returns a data frame with 1 column for
### each group, giving the point we will use to look for a close point
### on the grid, to put the group label.
 ...
### ignored.
 ){
  loc &lt;- loc.fun(d,debug)
  NREP &lt;- 10
  gridpts &lt;- d
  gl &lt;- function(v){
    s &lt;- seq(min(gridpts[,v]),max(gridpts[,v]),l=NREP)
    if(expand){
      dif &lt;- s[2]-s[1]
      s &lt;- seq(min(gridpts[,v])-expand*dif,
               max(gridpts[,v])+expand*dif,
               l=NREP+2*expand)
    }
    list(centers=s,diff=s[2]-s[1])
  }
  hgrid &lt;- function(x,w){
    hboxes &lt;- floor(diff(range(gridpts[,x]))/r[,w])
    (-expand:(hboxes+expand-1))*r[,w]+min(gridpts[,x])+r[,w]/2
  }
  if(debug)with(loc,grid.points(x,y,default.units="native"))
  draw &lt;- function(g){
    gridlines &lt;- with(g,list(x=unique(c(left,right)),y=unique(c(top,bottom))))
    drawlines &lt;- function(a,b,c,d)
      grid.segments(a,b,c,d,"native",gp=gpar(col="grey"))
    with(gridlines,drawlines(min(x),y,max(x),y))
    with(gridlines,drawlines(x,min(y),x,max(y)))
  }
  res &lt;- data.frame()
  for(v in loc$groups){
    r &lt;- subset(loc,groups==v)
    no.points &lt;- data.frame()
    expand &lt;- 0
    while(nrow(no.points)==0){
      boxes &lt;- if("left"%in%names(loc)){
        list(x=hgrid("x","w"),y=hgrid("y","h"),w=r$w,h=r$h)
      }else{
        L &lt;- sapply(c("x","y"),gl,simplify=FALSE)
        list(x=L$x$centers,y=L$y$centers,w=L$x$diff,h=L$y$diff)
      }
      boxes &lt;- <a href="../../utility.function/posfuns/calc.borders.html">calc.borders</a>(do.call(expand.grid,boxes))
      boxes &lt;- cbind(boxes,data=<a href="../../utility.function/posfuns/inside.html">inside</a>(boxes,d))
      no.points &lt;- transform(subset(boxes,data==0))
      expand &lt;- expand+1 ## look further out if we can't find any labels <a href="../../utility.function/posfuns/inside.html">inside</a>
    }
    if(debug)draw(boxes)
    no.points &lt;- transform(no.points,len=(r$x-x)^2+(r$y-y)^2)
    best &lt;- subset(no.points,len==min(len))[1,]
    res &lt;- rbind(res,transform(r,x=best$x,y=best$y))
    ## add points to cloud
    newpts &lt;- with(best,data.frame(x=c(left,left,right,right,x,x,x,left,right),
                                   y=c(bottom,top,top,bottom,top,bottom,y,y,y)))
    newpts &lt;- data.frame(newpts,
                         subset(d,select=-c(x,y))[1,,drop=FALSE],
                         row.names=NULL)
    d &lt;- rbind(d,newpts[,names(d)])
  }
  if(debug)with(d,grid.points(x,y))
  res
### Data frame with columns groups x y, 1 line for each group, giving
### the positions on the grid closest to each cluster.
}
</pre>

<table>
<tr>
  <td><img alt="class-manufacturer" src="../../scatterplot/class-manufacturer.empty.grid.png" /></td>
  <td><p><a href="../plots/class-manufacturer.html">class-manufacturer</a></p><pre>
data(mpg,package="ggplot2")
m &lt;- lm(cty~displ,data=mpg)
mpgf &lt;- fortify(m,mpg)
p &lt;- xyplot(jitter(.resid)~jitter(.fitted)|manufacturer,mpgf,groups=class)
direct.label(p,"empty.grid")
  </pre></td>
</tr>
<tr>
  <td><img alt="cylinders" src="../../scatterplot/cylinders.empty.grid.png" /></td>
  <td><p><a href="../plots/cylinders.html">cylinders</a></p><pre>
data(mpg,package="ggplot2")
m &lt;- lm(cty~displ,data=mpg)
mpgf &lt;- fortify(m,mpg)
p &lt;- xyplot(jitter(.resid)~jitter(.fitted),mpgf,groups=factor(cyl))
direct.label(p,"empty.grid")
  </pre></td>
</tr>
<tr>
  <td><img alt="iris" src="../../scatterplot/iris.empty.grid.png" /></td>
  <td><p><a href="../plots/iris.html">iris</a></p><pre>
p &lt;- xyplot(jitter(Sepal.Length)~jitter(Petal.Length),iris,groups=Species)
direct.label(p,"empty.grid")
  </pre></td>
</tr>
<tr>
  <td><img alt="mpglattice" src="../../scatterplot/mpglattice.empty.grid.png" /></td>
  <td><p><a href="../plots/mpglattice.html">mpglattice</a></p><pre>
data(mpg,package="ggplot2")
p &lt;- xyplot(jitter(cty)~jitter(hwy),mpg,groups=class,
       main="Fuel efficiency depends on car size")
direct.label(p,"empty.grid")
  </pre></td>
</tr>
<tr>
  <td><img alt="mpg" src="../../scatterplot/mpg.empty.grid.png" /></td>
  <td><p><a href="../plots/mpg.html">mpg</a></p><pre>
data(mpg,package="ggplot2")
p &lt;- qplot(jitter(hwy),jitter(cty),data=mpg,colour=class,
      main="Fuel efficiency depends on car size")
direct.label(p,"empty.grid")
  </pre></td>
</tr>
</table>

<center>
<table>
<tr><td>Please contact <a href="http://cbio.ensmp.fr/~thocking/">Toby
Dylan Hocking</a> if you are using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a> or have ideas to
contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from comments
in R source code
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>

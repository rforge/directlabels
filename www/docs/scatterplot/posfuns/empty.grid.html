<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

  <head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=UTF-8" />
	<link href="http://directlabels.r-forge.r-project.org/estilo1.css"
	rel="stylesheet" type="text/css" />
	<title>directlabels documentation - empty.grid</title>
  </head>

<body>

<h1><a href="../../index.html">directlabels</a> - scatterplot -
Positioning Function - empty.grid</h1>

<p>Label placement method for scatterplots that ensures labels are
placed in different places. A grid is drawn over the whole
plot. Each cluster is considered in sequence and assigned to the
point on this grid which is closest to the point given by
loc.fun().</p>

<pre>
empty.grid <- function
### Label placement method for scatterplots that ensures labels are
### placed in different places. A grid is drawn over the whole
### plot. Each cluster is considered in sequence and assigned to the
### point on this grid which is closest to the point given by
### loc.fun().
(d,
### Data frame of points on the scatterplot with columns groups x y.
 debug=FALSE,
### Show debugging info on the plot? This is passed to loc.fun.
 loc.fun=get.means,
### Function that takes d and returns a data frame with 1 column for
### each group, giving the point we will use to look for a close point
### on the grid, to put the group label.
 ...
### ignored.
 ){
  ##browser()
  loc <- loc.fun(d,debug)
  NREP <- 10
  gl <- function(v){
    s <- seq(from=min(d[,v]),to=max(d[,v]),l=NREP)
    list(centers=s,diff=(s[2]-s[1])/2)
  }
  L <- sapply(c("x","y"),gl,simplify=FALSE)
  g <- expand.grid(x=L$x$centers,y=L$y$centers)
  g2 <- transform(g,
                  left=x-L$x$diff,
                  right=x+L$x$diff,
                  top=y+L$y$diff,
                  bottom=y-L$y$diff)
  if(debug){
    gridlines <- with(g2,list(x=unique(c(left,right)),y=unique(c(top,bottom))))
    drawlines <- function(a,b,c,d)
      grid.segments(a,b,c,d,"native",gp=gpar(col="grey"))
    with(gridlines,drawlines(min(x),y,max(x),y))
    with(gridlines,drawlines(x,min(y),x,max(y)))
  }
  inbox <- function(x,y,left,right,top,bottom)
    c(data=sum(d$x>left & d$x<right & d$y>bottom & d$y<top))
  count.tab <- cbind(mdply(g2,inbox),expand.grid(i=1:NREP,j=1:NREP))
  if(debug){
    count.mat <- matrix(count.tab$data,nrow=NREP,ncol=NREP,
                        byrow=TRUE,dimnames=list(1:NREP,1:NREP))[NREP:1,]
    mode(count.mat) <- "character"
  }
  g3 <- transform(subset(count.tab,data==0))
  res <- data.frame()
  for(v in loc$groups){
    r <- subset(loc,groups==v)
    len <- sqrt((r$x-g3$x)^2+(r$y-g3$y)^2)
    i <- which.min(len) ## the box to use for this group
    if(debug)
      count.mat[as.character(g3[i,"j"]),
                as.character(g3[i,"i"])] <- paste("*",v,sep="")
    res <- rbind(res,g3[i,c("x","y")])
    therow <- g3[i,]
    ## select new subset of boxes for next label
    g3 <- subset(g3,!(abs(i-therow$i)<=1 & j==therow$j))
  }
  if(debug)print(count.mat)
  cbind(res,groups=loc$groups)
### Data frame with columns groups x y, 1 line for each group, giving
### the positions on the grid closest to each cluster.
}
</pre>

<table>
<tr>
  <td><img alt="cylinders" src="../../scatterplot/cylinders.empty.grid.png" /></td>
  <td><p><a href="../plots/cylinders.html">cylinders</a></p><pre>
data(mpg,package="ggplot2")
m &lt;- lm(cty~displ,data=mpg)
mpgf &lt;- fortify(m,mpg)
p &lt;- xyplot(.resid~.fitted,mpgf,groups=factor(cyl))
direct.label(p,"empty.grid")
  </pre></td>
</tr>
<tr>
  <td><img alt="mpg" src="../../scatterplot/mpg.empty.grid.png" /></td>
  <td><p><a href="../plots/mpg.html">mpg</a></p><pre>
data(mpg,package="ggplot2")
p &lt;- qplot(jitter(hwy),jitter(cty),data=mpg,colour=class,
      main="Fuel efficiency depends on car size")
direct.label(p,"empty.grid")
  </pre></td>
</tr>
</table>

<center>
<table>
<tr><td>Please send email
to <a href="http://r-forge.r-project.org/sendmessage.php?touser=1571">Toby
Dylan Hocking</a> if you are using <a href="http://directlabels.r-forge.r-project.org/">directlabels</a> or have ideas to
contribute, thanks!</td>
</tr>
<tr><td align="center">Documentation website generated from comments
in R source code
using <a href="http://inlinedocs.r-forge.r-project.org">inlinedocs</a>.</td>
</tr>
<tr>
<td align="center">
    <a href="http://validator.w3.org/check?uri=referer">validate</a>
</td>
</tr>
</table>

</center>

</body>

</html>
